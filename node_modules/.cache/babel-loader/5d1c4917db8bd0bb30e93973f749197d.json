{"ast":null,"code":"import _defineProperty from \"/home/mathias/Documents/privat/VK/vk-tool/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/home/mathias/Documents/privat/VK/vk-tool/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/mathias/Documents/privat/VK/vk-tool/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/mathias/Documents/privat/VK/vk-tool/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/mathias/Documents/privat/VK/vk-tool/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/mathias/Documents/privat/VK/vk-tool/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/home/mathias/Documents/privat/VK/vk-tool/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/home/mathias/Documents/privat/VK/vk-tool/src/app/views/AddBillingReportSteps/AddBillingReportStep2.tsx\";\nimport React, { Component } from \"react\";\nimport Table from \"../../components/Table\";\nimport { Typeahead } from 'react-bootstrap-typeahead'; //little hack because of missing typing\n\nvar Token = require('react-bootstrap-typeahead').Token;\n\nimport 'react-bootstrap-typeahead/css/Typeahead.css';\nimport 'react-bootstrap-typeahead/css/Typeahead-bs4.css';\nimport WizardStep from \"../../components/WizardStep\";\n\nvar AddBillingReportStep2 =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(AddBillingReportStep2, _Component);\n\n  function AddBillingReportStep2(props) {\n    var _this;\n\n    _classCallCheck(this, AddBillingReportStep2);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(AddBillingReportStep2).call(this, props));\n    _this.renderMenuItem = _this.renderMenuItem.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.renderToken = _this.renderToken.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.filterBy = _this.filterBy.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onAdd = _this.onAdd.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onInputChange = _this.onInputChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onTypeaheadChange = _this.onTypeaheadChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.removeTableItem = _this.removeTableItem.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.validate = _this.validate.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.state = {\n      tableEntries: {},\n      vks: [],\n      from: '',\n      until: ''\n    };\n    return _this;\n  }\n\n  _createClass(AddBillingReportStep2, [{\n    key: \"renderMenuItem\",\n    value: function renderMenuItem(option) {\n      var member = this.props.members.byId[option];\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 41\n        },\n        __self: this\n      }, member.firstname, \" \", member.lastname);\n    }\n  }, {\n    key: \"renderToken\",\n    value: function renderToken(option, props, index) {\n      var member = this.props.members.byId[option];\n      return React.createElement(Token, {\n        index: option //@ts-ignore\n        ,\n        onRemove: props.onRemove,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 50\n        },\n        __self: this\n      }, member.firstname, \" \", member.lastname);\n    }\n  }, {\n    key: \"filterBy\",\n    value: function filterBy(option, props) {\n      var member = this.props.members.byId[option];\n      return (member.firstname + ' ' + member.lastname).toLowerCase().indexOf(props.text.toLowerCase()) > -1 || (member.lastname + ' ' + member.firstname).toLowerCase().indexOf(props.text.toLowerCase()) > -1;\n    }\n  }, {\n    key: \"onAdd\",\n    value: function onAdd(event) {\n      event.preventDefault();\n\n      if (this.formEl) {\n        var selection = this.state.tableEntries;\n        var valid = this.formEl.checkValidity();\n        this.formEl.className = 'was-validated';\n\n        if (valid) {\n          valid = this.state.vks.length > 0;\n        }\n\n        if (valid) {\n          var _from = new Date(\"1970-01-01 \" + this.state.from);\n\n          var _until = new Date(\"1970-01-01 \" + this.state.until);\n\n          var totalHours = (_until.getTime() - _from.getTime()) / 1000 / 60 / 60;\n          if (totalHours < 0) totalHours = totalHours + 24;\n          var _iteratorNormalCompletion = true;\n          var _didIteratorError = false;\n          var _iteratorError = undefined;\n\n          try {\n            for (var _iterator = this.state.vks[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n              var i = _step.value;\n              selection[i] = {\n                member: this.props.members.byId[i],\n                from: this.state.from,\n                until: this.state.until,\n                totalHours: totalHours\n              };\n            }\n          } catch (err) {\n            _didIteratorError = true;\n            _iteratorError = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion && _iterator.return != null) {\n                _iterator.return();\n              }\n            } finally {\n              if (_didIteratorError) {\n                throw _iteratorError;\n              }\n            }\n          }\n\n          this.setState({\n            tableEntries: selection,\n            vks: [],\n            from: '',\n            until: ''\n          });\n        }\n      }\n    }\n  }, {\n    key: \"onInputChange\",\n    value: function onInputChange(event) {\n      var target = event.target;\n      var value = target.type === 'checkbox' ? target.checked : target.value;\n      var name = target.name; //@ts-ignore\n\n      this.setState(_defineProperty({}, name, value));\n    }\n  }, {\n    key: \"onTypeaheadChange\",\n    value: function onTypeaheadChange(selection) {\n      this.setState({\n        vks: selection\n      });\n    }\n  }, {\n    key: \"removeTableItem\",\n    value: function removeTableItem(event) {\n      if (event.currentTarget.parentNode && event.currentTarget.parentNode.parentElement) {\n        var id = event.currentTarget.parentNode.parentElement.getAttribute('data-key');\n\n        if (id) {\n          var entries = this.state.tableEntries;\n          delete entries[id];\n          this.setState({\n            tableEntries: entries\n          });\n        }\n      }\n    }\n  }, {\n    key: \"validate\",\n    value: function validate() {\n      if (Object.keys(this.state.tableEntries).length > 0) {\n        this.props.onNext({\n          vks: this.state.tableEntries\n        });\n        return true;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(WizardStep, Object.assign({\n        title: \"Einsatzzeiten\",\n        onNextStep: this.validate\n      }, this.props, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }), React.createElement(\"form\", {\n        ref: function ref(form) {\n          return _this2.formEl = form;\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }, React.createElement(\"h5\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }, \"VKs\"), React.createElement(Typeahead, {\n        name: \"vks\",\n        labelKey: \"vks\",\n        multiple: true,\n        selectHintOnEnter: true,\n        minLength: 2,\n        clearButton: true,\n        options: Object.keys(this.props.members.byId),\n        placeholder: \"VKs ausw\\xE4hlen\",\n        renderMenuItemChildren: this.renderMenuItem //@ts-ignore\n        ,\n        renderToken: this.renderToken,\n        filterBy: this.filterBy,\n        selected: this.state.vks,\n        onChange: this.onTypeaheadChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155\n        },\n        __self: this\n      }))), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 175\n        },\n        __self: this\n      }, React.createElement(\"h5\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 176\n        },\n        __self: this\n      }, \"Von\"), React.createElement(\"input\", {\n        type: \"time\",\n        name: \"from\",\n        value: this.state.from,\n        onChange: this.onInputChange,\n        className: \"form-control\",\n        required: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"col\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      }, React.createElement(\"h5\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180\n        },\n        __self: this\n      }, \"Bis\"), React.createElement(\"input\", {\n        type: \"time\",\n        name: \"until\",\n        value: this.state.until,\n        onChange: this.onInputChange,\n        className: \"form-control\",\n        required: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }))), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"col\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        className: \"btn btn-primary btn-block\",\n        onClick: this.onAdd,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, \"Hinzuf\\xFCgen\")))), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"row\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, React.createElement(Table, {\n        columns: [{\n          text: 'VK',\n          keys: {\n            'member': ['firstname', 'lastname']\n          }\n        }, {\n          text: 'Von',\n          keys: ['from']\n        }, {\n          text: 'Bis',\n          keys: ['until']\n        }, {\n          text: 'Anzahl Stunden',\n          keys: ['totalHours']\n        }, {\n          text: 'Actions',\n          keys: {\n            'member': ['_id']\n          },\n          content: React.createElement(\"button\", {\n            className: \"btn btn-danger\",\n            onClick: this.removeTableItem,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 199\n            },\n            __self: this\n          }, \"\\u2A2F\")\n        }],\n        data: this.state.tableEntries,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return AddBillingReportStep2;\n}(Component);\n\nexport { AddBillingReportStep2 as default };","map":{"version":3,"sources":["/home/mathias/Documents/privat/VK/vk-tool/src/app/views/AddBillingReportSteps/AddBillingReportStep2.tsx"],"names":["React","Component","Table","Typeahead","Token","require","WizardStep","AddBillingReportStep2","props","renderMenuItem","bind","renderToken","filterBy","onAdd","onInputChange","onTypeaheadChange","removeTableItem","validate","state","tableEntries","vks","from","until","option","member","members","byId","firstname","lastname","index","onRemove","toLowerCase","indexOf","text","event","preventDefault","formEl","selection","valid","checkValidity","className","length","Date","totalHours","getTime","i","setState","target","value","type","checked","name","currentTarget","parentNode","parentElement","id","getAttribute","entries","Object","keys","onNext","form","content"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { DataInterface } from \"../../reducers/DataReducer\";\nimport ContactModel from \"../../../shared/models/ContactModel\";\nimport Table from \"../../components/Table\";\n\nimport { Typeahead, TypeaheadFilterbyProps, TypeaheadProps } from 'react-bootstrap-typeahead'\n//little hack because of missing typing\nconst Token = require('react-bootstrap-typeahead').Token\n\nimport 'react-bootstrap-typeahead/css/Typeahead.css';\nimport 'react-bootstrap-typeahead/css/Typeahead-bs4.css';\nimport StringIndexed from \"../../interfaces/StringIndexed\";\nimport WizardStep from \"../../components/WizardStep\";\nimport { BillingReportCompensationEntry } from \"../../interfaces/BillingReport\";\n\nexport default class AddBillingReportStep2 extends Component<{ onNext: (data: StringIndexed<any>) => void, members: DataInterface<ContactModel> }, { tableEntries: StringIndexed<BillingReportCompensationEntry>, vks: Array<string>, from: string, until: string }> {\n    private formEl?: HTMLFormElement\n\n    constructor(props: { onNext: (data: StringIndexed<any>) => void, members: DataInterface<ContactModel> }) {\n        super(props)\n        this.renderMenuItem = this.renderMenuItem.bind(this)\n        this.renderToken = this.renderToken.bind(this)\n        this.filterBy = this.filterBy.bind(this)\n        this.onAdd = this.onAdd.bind(this)\n        this.onInputChange = this.onInputChange.bind(this)\n        this.onTypeaheadChange = this.onTypeaheadChange.bind(this)\n        this.removeTableItem = this.removeTableItem.bind(this)\n        this.validate = this.validate.bind(this)\n\n        this.state = {\n            tableEntries: {},\n            vks: [],\n            from: '',\n            until: ''\n        }\n    }\n\n    private renderMenuItem(option: string) {\n        let member = this.props.members.byId[option]\n        return (\n            <div>\n                {member.firstname} {member.lastname}\n            </div>\n        )\n    }\n\n    private renderToken(option: string, props: TypeaheadProps<string>, index: number) {\n        let member = this.props.members.byId[option]\n        return (\n            <Token\n                index={option}\n                //@ts-ignore\n                onRemove={props.onRemove}\n            >\n                {member.firstname} {member.lastname}\n            </Token>\n        )\n    }\n\n    private filterBy(option: string, props: TypeaheadFilterbyProps): boolean {\n        let member = this.props.members.byId[option]\n        return (\n            (member.firstname + ' ' + member.lastname).toLowerCase().indexOf(props.text.toLowerCase()) > -1 ||\n            (member.lastname + ' ' + member.firstname).toLowerCase().indexOf(props.text.toLowerCase()) > -1\n        )\n    }\n\n    private onAdd(event: React.MouseEvent<HTMLButtonElement>) {\n        event.preventDefault()\n        if (this.formEl) {\n            let selection = this.state.tableEntries\n            let valid = this.formEl.checkValidity()\n            this.formEl.className = 'was-validated'\n\n            if (valid) {\n                valid = this.state.vks.length > 0\n            }\n\n            if (valid) {\n                let from = new Date(\"1970-01-01 \" + this.state.from)\n                let until = new Date(\"1970-01-01 \" + this.state.until)\n                let totalHours = (until.getTime() - from.getTime()) / 1000 / 60 / 60\n\n                if (totalHours < 0) totalHours = totalHours + 24\n\n                for (let i of this.state.vks) {\n                    selection[i] = {\n                        member: this.props.members.byId[i],\n                        from: this.state.from,\n                        until: this.state.until,\n                        totalHours: totalHours\n                    }\n                }\n\n                this.setState({\n                    tableEntries: selection,\n                    vks: [],\n                    from: '',\n                    until: ''\n                })\n            }\n        }\n    }\n\n    private onInputChange(event: React.ChangeEvent<HTMLInputElement>) {\n        const target = event.target;\n        const value = target.type === 'checkbox' ? target.checked : target.value;\n        const name = target.name;\n\n        //@ts-ignore\n        this.setState({\n            [name]: value\n        });\n    }\n\n    private onTypeaheadChange(selection: Array<string>) {\n        this.setState({\n            vks: selection\n        })\n    }\n\n    private removeTableItem(event: React.MouseEvent<HTMLButtonElement>) {\n        if (event.currentTarget.parentNode && event.currentTarget.parentNode.parentElement) {\n            let id = event.currentTarget.parentNode.parentElement.getAttribute('data-key')\n\n            if (id) {\n                let entries = this.state.tableEntries\n                delete entries[id]\n                this.setState({\n                    tableEntries: entries\n                })\n            }\n        }\n    }\n\n    private validate(): boolean {\n        if (Object.keys(this.state.tableEntries).length > 0) {\n            this.props.onNext({\n                vks: this.state.tableEntries\n            })\n\n            return true\n        }\n\n        return false\n    }\n\n    public render() {\n        return (\n            <WizardStep title=\"Einsatzzeiten\" onNextStep={this.validate} {...this.props}>\n                <form ref={(form: HTMLFormElement) => this.formEl = form}>\n                    <div className=\"row\">\n                        <div className=\"col\">\n                            <h5>VKs</h5>\n                            <Typeahead\n                                name=\"vks\"\n                                labelKey=\"vks\"\n                                multiple={true}\n                                selectHintOnEnter={true}\n                                minLength={2}\n                                clearButton={true}\n                                options={Object.keys(this.props.members.byId)}\n                                placeholder=\"VKs auswählen\"\n                                renderMenuItemChildren={this.renderMenuItem}\n                                //@ts-ignore\n                                renderToken={this.renderToken}\n                                filterBy={this.filterBy}\n                                selected={this.state.vks}\n                                onChange={this.onTypeaheadChange}\n                            />\n                        </div>\n                    </div>\n                    <br></br>\n                    <div className=\"row\">\n                        <div className=\"col\">\n                            <h5>Von</h5>\n                            <input type=\"time\" name=\"from\" value={this.state.from} onChange={this.onInputChange} className='form-control' required={true} />\n                        </div>\n                        <div className=\"col\">\n                            <h5>Bis</h5>\n                            <input type=\"time\" name=\"until\" value={this.state.until} onChange={this.onInputChange} className='form-control' required={true} />\n                        </div>\n                    </div>\n                    <br></br>\n                    <div className=\"row\">\n                        <div className=\"col\">\n                            <button className=\"btn btn-primary btn-block\" onClick={this.onAdd}>Hinzufügen</button>\n                        </div>\n                    </div>\n                </form>\n                <br></br>\n                <div className=\"row\">\n                    <Table<BillingReportCompensationEntry>\n                        columns={[\n                            { text: 'VK', keys: { 'member': ['firstname', 'lastname'] } },\n                            { text: 'Von', keys: ['from'] },\n                            { text: 'Bis', keys: ['until'] },\n                            { text: 'Anzahl Stunden', keys: ['totalHours'] },\n                            { text: 'Actions', keys: { 'member': ['_id'] }, content: <button className=\"btn btn-danger\" onClick={this.removeTableItem}>⨯</button> }\n                        ]}\n                        data={this.state.tableEntries}\n                    />\n                </div>\n            </WizardStep>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}